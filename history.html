<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <div class="container text-center my-2 w-75">
        <h1>History</h1>

        <div class="w-100 my-4 border border-secondary">
            <div class="text-center my-2">
                <h4>Connect Four</h4>
            </div>

            <div class="row my-2">
                <div id="connect-four-champion-name" class="col"></div>
                <div id="connect-four-champion-freq" class="col"></div>
            </div>

            <div class="row my-2">
                <div id="connect-four-last-played"></div>
            </div>

        </div>

        <button type="button" class="btn btn-outline-secondary w-100">Return to Menu</button>

    </div>



</body>

<script>

    // history list
    let retrievedData = localStorage.getItem('connectFourHistory');
    let connectFourHistory = JSON.parse(retrievedData);
    if(!connectFourHistory) {
        connectFourHistory = [];
    }

    let boxConnectFourChampion = $('#connect-four-champion-name');
    let boxConnectFourChampionFreq = $('#connect-four-champion-freq');
    let connectFourChampion = champion(connectFourHistory);
    let connectFourChampionFreq = champFrequency(winnersFrequency(connectFourHistory), connectFourChampion);
    let boxConnectFourLastPlayed = $('#connect-four-last-played');
    let connectFourLast = connectFourHistory[connectFourHistory.length - 1]

    if (connectFourHistory) {
        boxConnectFourChampion.text(`Champion: ${connectFourChampion}`);
        boxConnectFourChampionFreq.text(`${connectFourChampionFreq} victories`);
        boxConnectFourLastPlayed.text(`Last time played ${connectFourLast.atDate} at ${connectFourLast.atTime} (${connectFourLast.player1} vs ${connectFourLast.player2}) winner: ${connectFourLast.winner}`);
    } else {
        boxConnectFourChampion.text(
            'Never played :('
        );
    }

    function champion(history) {
        if (history.length === 0) {
            return false;
        }
        let champList = history.map(function (game) {
            return game.winner;
        });
        return getMostFrequent(champList);
    }

    // https://javascript.plainenglish.io/how-to-find-the-most-frequent-element-in-an-array-in-javascript-c85119dc78d2
    function getMostFrequent(arr) {
        const hashmap = arr.reduce( (acc, val) => {
            acc[val] = (acc[val] || 0 ) + 1
            return acc
        },{})
        return Object.keys(hashmap).reduce((a, b) => hashmap[a] > hashmap[b] ? a : b)
    }

    function winnersFrequency(history) {
        let winnersFrequency = {};
        history.forEach(function (game) {
            if (winnersFrequency[game.winner]) {
                return winnersFrequency[game.winner] += 1;
            } else {
                return winnersFrequency[game.winner] = 1;
            }
        });
        return winnersFrequency;
    }

    function champFrequency(winnerFrequency, champion) {
        return winnerFrequency[champion];
    }

</script>

</html>
