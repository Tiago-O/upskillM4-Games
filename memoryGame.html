<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jogo memória</title>
    <style>
        form {
            background: black;
            color: white;
            padding: 1em;
        }

        #grid {

        }

        .grid-row {
            margin: 1em;
        }

        .grid-card {
            background-color: gray;
            margin: 1em;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Memory Game</h1>
    <div>
        <form>
            <label>Who is playing?</label><br>
            <input type="text" required placeholder="Name" id="playerName"><br>

            <label>Dificuldade</label><br>

            <!-- Input type radio: tem todos de ter o mesmo name -->
            <div>
                <input type="radio" id="easy" name="level" value="easy" class="level">
                <label for="easy">Easy 3 x 4</label>
            </div>

            <div>
                <input type="radio" id="medium" name="level" value="medium" class="level">
                <label for="medium">Medium 4 x 4</label>
            </div>

            <div>
                <input type="radio" id="advanced" name="level" value="advanced" class="level">
                <label for="advanced">Advanced 4 x 5</label>
            </div>

            <!-- <button type="button" class="level" value="easy">Easy 3 x 4</button><br>
            <button type="button" class="level" value="medium">Medium 4 x 4</button><br>
            <button type="button" class="level" value="advanced">Advanced 4 x 5</button><br> -->

            <button type="button" id="startButton">Play!</button>
        </form>
    </div>
</body>

<script>
    let startButton = $('#startButton');
    let playerName = $('#playerName');
    let body = $('body');
    //let level = $('.level');

    let cardValues = [];

    // ### Read input values and display results
    startButton.click(function() {
        let playerNameValue = playerName.val();
        let levelValue = document.querySelector('input[name="level"]:checked').value // TODO: confirm if it's the best way to do it.
        let formValidity = true;

        // ## Check form validity
        /*if(!(playerNameValue[0].checkValidity() || levelValue[0].checkValidity())) {
            nome.addClass("is-invalid");
            formValidity = false;
        }*/

        if(formValidity) {
            body.append(`<div>
                <h2>Welcome ${playerNameValue}</h2>
                <h3>Current level: ${levelValue}</h3>
            </div>`)

            // # Clear input:
            playerName.val('');
            // TODO: disabled button.

            // # Create cards values:
            setRandomCardValues(levelValue, getCardsRows(levelValue), getCardsColumns(levelValue));

            // # Show cards:
            displayCards(getCardsRows(levelValue), getCardsColumns(levelValue));
        }
    })

    // ### Create and display cards grid dynamically

    // * easy: 3 rows x 4 columns
    // * medium: 4 rows x 4 columns
    // * advanced: 4 rows x 5 columns

    // ## Display cards
    function displayCards(rows, columns) {

        body.append(`<div id="grid"></div>`)
        let grid = $('#grid');
        for (let r = 0; r < rows; r++) {
            grid.append(`<div class="grid-row">`)
            for (let c = 0; c < columns; c++) {
                let cell = $(`<span class="grid-card">
                    Card ${c} ${r}
                </span>`);
                // cell.onclick
                grid.append(cell)

            }
            grid.append(`</div>`)
        }

    }

    // # Get rows
    function getCardsRows(levelValue) {

        let rows = 4;

        if(levelValue === 'easy') {
            rows = 3;
        }
        return rows;
    }

    // # Get columns
    function getCardsColumns(levelValue) {

        let columns = 4;

        if(levelValue === 'advanced'){
            columns = 5;
        }
        return columns;
    }

    // ### Random card values
    function setRandomCardValues(levelValue, rows, columns) {

        // * easy: 6 card types
        // * medium: 8 card types
        // * advanced: 10 card types

        let counterValues = []; // maximum 2 values of the same type
        let totalTypes = [];

        if(levelValue ==='easy') {
            totalTypes.length = 6;
        } else if(levelValue === 'medium') {
            totalTypes.length = 8;
        } else if(levelValue === 'advanced') {
            totalTypes.length = 10;
        }

        // Reset
        for (let i = 0; i < totalTypes.length; i++) {
            counterValues[i] = 0;
            totalTypes[i] = i;
        }

        for (let r = 0; r < rows; r++) {
                cardValues[r] = [];
            for (let c = 0; c < columns; c++) {
                cardValues[r][c] = randomCardValue(totalTypes)
                //console.log(cardValues[r][c]);
                counterValues[cardValues[r][c]]++ // Increment counter values
                if(counterValues[cardValues[r][c]] >= 2 ) {
                    totalTypes = totalTypes.filter(function(value) {
                        return value !== cardValues[r][c]; // Remove type value
                    })
                }
                //console.log(totalTypes)
            }
        }
        console.log(cardValues)
    }

    // ## Return random value between 0 and totalTypes.length
    function randomCardValue(totalTypes) {
        return totalTypes[Math.floor( Math.random() * totalTypes.length)];
    }


    //currentCardSelection.click(function() {

    //}

    // Dúvida: adicionar valor do simbolo. Qual a melhor maneira de atribuir?

</script>

</html>